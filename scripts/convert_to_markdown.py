#!/usr/bin/env python3
"""
å°†è½¬å½•çš„txtæ–‡æ¡£è½¬æ¢ä¸ºç»“æ„åŒ–çš„Markdownæ ¼å¼
"""

import os
import re
from pathlib import Path
import json

def clean_and_segment_text(text):
    """æ¸…ç†æ–‡æœ¬å¹¶è¿›è¡Œæ™ºèƒ½åˆ†æ®µ"""
    # ç§»é™¤æ–‡ä»¶å¤´
    lines = text.split('\n')
    if lines[0].startswith('è§†é¢‘:'):
        lines = lines[3:]  # è·³è¿‡å‰ä¸‰è¡Œ

    text = '\n'.join(lines)

    # ä¿®æ­£å¸¸è§çš„è¯†åˆ«é”™è¯¯
    corrections = {
        'Agentçš„': 'Agent ',
        'Agent ': 'Agent ',
        'MCPçš„': 'MCP ',
        'RAGçš„': 'RAG ',
        'A2Açš„': 'A2A ',
        'Contextçš„': 'Context ',
        'å·æ‡‡': 'Token',
        'ç´‹æœ¬': 'æ–‡æœ¬',
        'æ›¸å…¥': 'è¾“å…¥',
        'åå›': 'è¿”å›',
        'æ¦®è­½': 'å®¹æ˜“',
        'é›»å½±': 'è°ƒç”¨',
        'éŸ“æ•¸': 'å‡½æ•°',
        'ç‹¼Cin': 'LangChain',
        'Chaggbt': 'ChatGPT',
        'GEMON': 'Gemini',
        'JAMMDR': 'Gemini',
        'DipSync': 'DeepSeek',
        'Cloud': 'Claude',
        'è¨˜æ†¶': 'è®°å¿†',
        'é ˜åŸŸ': 'é¢†åŸŸ',
        'å•é¡Œ': 'é—®é¢˜',
        'è¼¸å…¥': 'è¾“å…¥',
        'è¼¸å‡º': 'è¾“å‡º',
        'æ•¸æ“š': 'æ•°æ®',
        'è¨­è¨ˆ': 'è®¾è®¡',
        'é¸æ“‡': 'é€‰æ‹©',
        'å£“ç¸®': 'å‹ç¼©',
        'éš”é›¢': 'éš”ç¦»',
        'å¯¦ç¾': 'å®ç°',
        'æŠ€è¡“': 'æŠ€æœ¯',
        'è™•ç†': 'å¤„ç†',
        'é‹è¡Œ': 'è¿è¡Œ',
        'åŸ·è¡Œ': 'æ‰§è¡Œ',
        'å‰µå»º': 'åˆ›å»º',
        'é–‹å§‹': 'å¼€å§‹',
        'çµæŸ': 'ç»“æŸ',
        'æ™‚é–“': 'æ—¶é—´',
        'å…§å®¹': 'å†…å®¹',
        'ä¿¡æ¯': 'ä¿¡æ¯',
        'æ•¸é‡': 'æ•°é‡',
        'å±¬æ€§': 'å±æ€§',
        'é¡å‹': 'ç±»å‹',
        'åƒæ•¸': 'å‚æ•°',
        'è«‹æ±‚': 'è¯·æ±‚',
        'çµæœ': 'ç»“æœ',
        'ç‹€æ…‹': 'çŠ¶æ€',
        'åŠŸèƒ½': 'åŠŸèƒ½',
        'ç³»çµ±': 'ç³»ç»Ÿ',
        'å·¥å…·': 'å·¥å…·',
        'æœå‹™': 'æœåŠ¡',
        'ç¶²çµ¡': 'ç½‘ç»œ',
        'é€£æ¥': 'è¿æ¥',
        'å”è­°': 'åè®®',
        'è¦ç¯„': 'è§„èŒƒ',
        'æ¨™æº–': 'æ ‡å‡†',
        'æ‡‰ç”¨': 'åº”ç”¨',
        'é–‹ç™¼': 'å¼€å‘',
        'æ¸¬è©¦': 'æµ‹è¯•',
        'ç’°å¢ƒ': 'ç¯å¢ƒ',
        'é…ç½®': 'é…ç½®',
        'ç®¡ç†': 'ç®¡ç†',
        'å„ªåŒ–': 'ä¼˜åŒ–',
        'åˆ†æ': 'åˆ†æ',
        'è™•ç†': 'å¤„ç†',
        'è½‰æ›': 'è½¬æ¢',
        'å­˜å„²': 'å­˜å‚¨',
        'è®€å–': 'è¯»å–',
        'å¯«å…¥': 'å†™å…¥',
        'åˆªé™¤': 'åˆ é™¤',
        'æ›´æ–°': 'æ›´æ–°',
        'æŸ¥è©¢': 'æŸ¥è¯¢',
        'æœç´¢': 'æœç´¢',
        'éæ¿¾': 'è¿‡æ»¤',
        'æ’åº': 'æ’åº',
        'è¨ˆç®—': 'è®¡ç®—',
        'çµ±è¨ˆ': 'ç»Ÿè®¡',
        'é¡¯ç¤º': 'æ˜¾ç¤º',
        'éš±è—': 'éšè—',
        'ç¢ºèª': 'ç¡®è®¤',
        'å–æ¶ˆ': 'å–æ¶ˆ',
        'æäº¤': 'æäº¤',
        'ä¿å­˜': 'ä¿å­˜',
        'è¼‰å…¥': 'è½½å…¥',
        'åŒ¯å‡º': 'å¯¼å‡º',
        'åŒ¯å…¥': 'å¯¼å…¥',
        'å‚™ä»½': 'å¤‡ä»½',
        'æ¢å¾©': 'æ¢å¤',
        'ç›£æ§': 'ç›‘æ§',
        'å ±å‘Š': 'æŠ¥å‘Š',
        'é€šçŸ¥': 'é€šçŸ¥',
        'è­¦å‘Š': 'è­¦å‘Š',
        'éŒ¯èª¤': 'é”™è¯¯',
        'æˆåŠŸ': 'æˆåŠŸ',
        'å¤±æ•—': 'å¤±è´¥',
        'é€²åº¦': 'è¿›åº¦',
        'å®Œæˆ': 'å®Œæˆ',
        'ç­‰å¾…': 'ç­‰å¾…',
        'æº–å‚™': 'å‡†å¤‡',
        'é–‹å•Ÿ': 'å¼€å¯',
        'é—œé–‰': 'å…³é—­',
        'å•Ÿå‹•': 'å¯åŠ¨',
        'åœæ­¢': 'åœæ­¢',
        'æš«åœ': 'æš‚åœ',
        'ç¹¼çºŒ': 'ç»§ç»­',
        'é‡è©¦': 'é‡è¯•',
        'å›æ»¾': 'å›æ»š',
        'å‡ç´š': 'å‡çº§',
        'é™ç´š': 'é™çº§',
        'æ“´å±•': 'æ‰©å±•',
        'æ”¶ç¸®': 'æ”¶ç¼©',
        'å¢åŠ ': 'å¢åŠ ',
        'æ¸›å°‘': 'å‡å°‘',
        'èª¿æ•´': 'è°ƒæ•´',
        'ä¿®æ”¹': 'ä¿®æ”¹',
        'è¨­å®š': 'è®¾å®š',
        'è®Šæ›´': 'å˜æ›´',
        'ç¢ºå®š': 'ç¡®å®š',
        'é©—è­‰': 'éªŒè¯',
        'æˆæ¬Š': 'æˆæƒ',
        'èªè­‰': 'è®¤è¯',
        'åŠ å¯†': 'åŠ å¯†',
        'è§£å¯†': 'è§£å¯†',
        'ç°½å': 'ç­¾å',
        'é©—ç°½': 'éªŒç­¾',
        'å‚³è¼¸': 'ä¼ è¾“',
        'æ¥æ”¶': 'æ¥æ”¶',
        'ç™¼é€': 'å‘é€',
        'å»£æ’­': 'å¹¿æ’­',
        'è¨‚é–±': 'è®¢é˜…',
        'ç™¼å¸ƒ': 'å‘å¸ƒ',
        'åŒæ­¥': 'åŒæ­¥',
        'ç•°æ­¥': 'å¼‚æ­¥',
        'ä¸¦è¡Œ': 'å¹¶è¡Œ',
        'ä¸²è¡Œ': 'ä¸²è¡Œ',
        'é–å®š': 'é”å®š',
        'è§£é–': 'è§£é”',
        'é˜»å¡': 'é˜»å¡',
        'éé˜»å¡': 'éé˜»å¡',
        'è§¸ç™¼': 'è§¦å‘',
        'å›èª¿': 'å›è°ƒ',
        'äº‹ä»¶': 'äº‹ä»¶',
        'ç›£è½': 'ç›‘å¬',
        'éŸ¿æ‡‰': 'å“åº”',
        'è™•ç†å™¨': 'å¤„ç†å™¨',
        'ä¸­é–“ä»¶': 'ä¸­é—´ä»¶',
        'æ’ä»¶': 'æ’ä»¶',
        'æ¨¡å¡Š': 'æ¨¡å—',
        'çµ„ä»¶': 'ç»„ä»¶',
        'æœå‹™å™¨': 'æœåŠ¡å™¨',
        'å®¢æˆ¶ç«¯': 'å®¢æˆ·ç«¯',
        'æ•¸æ“šåº«': 'æ•°æ®åº“',
        'ç·©å­˜': 'ç¼“å­˜',
        'éšŠåˆ—': 'é˜Ÿåˆ—',
        'æ¶ˆæ¯': 'æ¶ˆæ¯',
        'é€šé“': 'é€šé“',
        'æœƒè©±': 'ä¼šè¯',
        'é€£çµ': 'é“¾æ¥',
        'ç¯€é»': 'èŠ‚ç‚¹',
        'é›†ç¾¤': 'é›†ç¾¤',
        'è² è¼‰': 'è´Ÿè½½',
        'å‡è¡¡': 'å‡è¡¡',
        'å®¹éŒ¯': 'å®¹é”™',
        'å‚™æ´': 'å¤‡æ´',
        'ç½å‚™': 'ç¾å¤‡',
        'é·ç§»': 'è¿ç§»',
        'è¤‡è£½': 'å¤åˆ¶',
        'å‚™ä»½': 'å¤‡ä»½',
        'å¿«ç…§': 'å¿«ç…§',
        'é¡åƒ': 'é•œåƒ',
        'å…‹éš†': 'å…‹éš†',
        'åˆ†æ”¯': 'åˆ†æ”¯',
        'åˆä½µ': 'åˆå¹¶',
        'è¡çª': 'å†²çª',
        'è§£æ±º': 'è§£å†³',
        'æäº¤': 'æäº¤',
        'æ¨é€': 'æ¨é€',
        'æ‹‰å–': 'æ‹‰å–',
        'åŒæ­¥': 'åŒæ­¥',
        'æ¨™ç±¤': 'æ ‡ç­¾',
        'ç‰ˆæœ¬': 'ç‰ˆæœ¬',
        'ç™¼ä½ˆ': 'å‘å¸ƒ',
        'éƒ¨ç½²': 'éƒ¨ç½²',
        'æ§‹å»º': 'æ„å»º',
        'ç·¨è­¯': 'ç¼–è¯‘',
        'æ‰“åŒ…': 'æ‰“åŒ…',
        'æ¸¬è©¦': 'æµ‹è¯•',
        'èª¿è©¦': 'è°ƒè¯•',
        'å„ªåŒ–': 'ä¼˜åŒ–',
        'æ€§èƒ½': 'æ€§èƒ½',
        'ç›£æ§': 'ç›‘æ§',
        'æ—¥èªŒ': 'æ—¥å¿—',
        'è¿½è¹¤': 'è¿½è¸ª',
        'åˆ†æ': 'åˆ†æ',
        'å ±è¡¨': 'æŠ¥è¡¨',
        'å„€è¡¨æ¿': 'ä»ªè¡¨æ¿',
        'è¦–è¦ºåŒ–': 'å¯è§†åŒ–',
        'åœ–è¡¨': 'å›¾è¡¨',
        'çµ±è¨ˆ': 'ç»Ÿè®¡',
        'æ•¸æ“š': 'æ•°æ®',
        'æŒ‡æ¨™': 'æŒ‡æ ‡',
        'é–¾å€¼': 'é˜ˆå€¼',
        'å‘Šè­¦': 'å‘Šè­¦',
        'é€šçŸ¥': 'é€šçŸ¥',
        'éƒµä»¶': 'é‚®ä»¶',
        'çŸ­ä¿¡': 'çŸ­ä¿¡',
        'æ¨é€': 'æ¨é€',
        'è¨‚é–±': 'è®¢é˜…',
        'å–æ¶ˆè¨‚é–±': 'å–æ¶ˆè®¢é˜…',
        'ç”¨æˆ¶': 'ç”¨æˆ·',
        'æ¬Šé™': 'æƒé™',
        'è§’è‰²': 'è§’è‰²',
        'ç¾¤çµ„': 'ç¾¤ç»„',
        'çµ„ç¹”': 'ç»„ç»‡',
        'åœ˜éšŠ': 'å›¢é˜Ÿ',
        'å°ˆæ¡ˆ': 'é¡¹ç›®',
        'ä»»å‹™': 'ä»»åŠ¡',
        'å·¥å–®': 'å·¥å•',
        'éœ€æ±‚': 'éœ€æ±‚',
        'ç¼ºé™·': 'ç¼ºé™·',
        'æ”¹é€²': 'æ”¹è¿›',
        'å„ªåŒ–': 'ä¼˜åŒ–',
        'é‡æ§‹': 'é‡æ„',
        'é·ç§»': 'è¿ç§»',
        'å‡ç´š': 'å‡çº§',
        'ç¶­è­·': 'ç»´æŠ¤',
        'æ”¯æ´': 'æ”¯æŒ',
        'æœå‹™': 'æœåŠ¡',
        'å”åŠ©': 'ååŠ©',
        'å¹«åŠ©': 'å¸®åŠ©',
        'æ–‡æª”': 'æ–‡æ¡£',
        'æ‰‹å†Š': 'æ‰‹å†Œ',
        'æŒ‡å—': 'æŒ‡å—',
        'æ•™ç¨‹': 'æ•™ç¨‹',
        'ç¯„ä¾‹': 'ç¤ºä¾‹',
        'æ¨¡æ¿': 'æ¨¡æ¿',
        'æ¡†æ¶': 'æ¡†æ¶',
        'åº«': 'åº“',
        'å¥—ä»¶': 'å¥—ä»¶',
        'ä¾è³´': 'ä¾èµ–',
        'ç›¸ä¾æ€§': 'ä¾èµ–æ€§',
        'ç›¸å®¹æ€§': 'å…¼å®¹æ€§',
        'ç‰ˆæœ¬': 'ç‰ˆæœ¬',
        'æ›´æ–°': 'æ›´æ–°',
        'ä¿®è£œ': 'ä¿®è¡¥',
        'è£œä¸': 'è¡¥ä¸',
        'ç†±ä¿®å¾©': 'çƒ­ä¿®å¤',
        'å›æ»¾': 'å›æ»š',
        'é‚„åŸ': 'è¿˜åŸ',
        'å¾©åŸ': 'å¤åŸ',
        'æ’¤éŠ·': 'æ’¤é”€',
        'é‡åš': 'é‡åš',
        'æ­·å²': 'å†å²',
        'è¨˜éŒ„': 'è®°å½•',
        'è¿½è¹¤': 'è¿½è¸ª',
        'å¯©è¨ˆ': 'å®¡è®¡',
        'åˆè¦': 'åˆè§„',
        'å®‰å…¨': 'å®‰å…¨',
        'æ¼æ´': 'æ¼æ´',
        'å¨è„…': 'å¨èƒ',
        'é¢¨éšª': 'é£é™©',
        'è©•ä¼°': 'è¯„ä¼°',
        'ç·©è§£': 'ç¼“è§£',
        'ä¿®å¾©': 'ä¿®å¤',
        'é˜²è­·': 'é˜²æŠ¤',
        'æª¢æ¸¬': 'æ£€æµ‹',
        'æƒæ': 'æ‰«æ',
        'ç›£æ¸¬': 'ç›‘æµ‹',
        'é è­¦': 'é¢„è­¦',
        'æ‡‰æ€¥': 'åº”æ€¥',
        'æ¢å¾©': 'æ¢å¤',
        'å‚™æ´': 'å¤‡æ´',
        'åˆ‡æ›': 'åˆ‡æ¢',
        'å®¹ç½': 'å®¹ç¾',
        'é«˜å¯ç”¨': 'é«˜å¯ç”¨',
        'è² è¼‰å‡è¡¡': 'è´Ÿè½½å‡è¡¡',
        'è‡ªå‹•æ“´å±•': 'è‡ªåŠ¨æ‰©å±•',
        'å½ˆæ€§ä¼¸ç¸®': 'å¼¹æ€§ä¼¸ç¼©',
        'è³‡æº': 'èµ„æº',
        'é…é¡': 'é…é¢',
        'é™åˆ¶': 'é™åˆ¶',
        'ç´„æŸ': 'çº¦æŸ',
        'è¦å‰‡': 'è§„åˆ™',
        'ç­–ç•¥': 'ç­–ç•¥',
        'æ¼”ç®—æ³•': 'ç®—æ³•',
        'é‚è¼¯': 'é€»è¾‘',
        'æµç¨‹': 'æµç¨‹',
        'æ­¥é©Ÿ': 'æ­¥éª¤',
        'éšæ®µ': 'é˜¶æ®µ',
        'ç‹€æ…‹': 'çŠ¶æ€',
        'è½‰æ›': 'è½¬æ¢',
        'è§¸ç™¼': 'è§¦å‘',
        'æ¢ä»¶': 'æ¡ä»¶',
        'åˆ¤æ–·': 'åˆ¤æ–­',
        'æ±ºç­–': 'å†³ç­–',
        'é¸æ“‡': 'é€‰æ‹©',
        'è·¯ç”±': 'è·¯ç”±',
        'åˆ†ç™¼': 'åˆ†å‘',
        'èª¿åº¦': 'è°ƒåº¦',
        'æ’ç¨‹': 'æ’ç¨‹',
        'å„ªå…ˆç´š': 'ä¼˜å…ˆçº§',
        'æ¬Šé‡': 'æƒé‡',
        'å¹³è¡¡': 'å¹³è¡¡',
        'å„ªåŒ–': 'ä¼˜åŒ–',
        'èª¿å„ª': 'è°ƒä¼˜',
        'æ•ˆèƒ½': 'æ€§èƒ½',
        'åå': 'åå',
        'å»¶é²': 'å»¶è¿Ÿ',
        'éŸ¿æ‡‰': 'å“åº”',
        'ä¸¦ç™¼': 'å¹¶å‘',
        'åŒæ™‚': 'åŒæ—¶',
        'é †åº': 'é¡ºåº',
        'æœ‰åº': 'æœ‰åº',
        'ç„¡åº': 'æ— åº',
        'åŒæ­¥': 'åŒæ­¥',
        'ç•°æ­¥': 'å¼‚æ­¥',
        'é˜»å¡': 'é˜»å¡',
        'éé˜»å¡': 'éé˜»å¡',
        'è¶…æ™‚': 'è¶…æ—¶',
        'é‡è©¦': 'é‡è¯•',
        'å›é€€': 'å›é€€',
        'é™ç´š': 'é™çº§',
        'ç†”æ–·': 'ç†”æ–­',
        'é™æµ': 'é™æµ',
        'æ’éšŠ': 'æ’é˜Ÿ',
        'ç·©è¡': 'ç¼“å†²',
        'æ‰¹æ¬¡': 'æ‰¹æ¬¡',
        'æ‰¹é‡': 'æ‰¹é‡',
        'å–®ä¸€': 'å•ä¸€',
        'å¤šé‡': 'å¤šé‡',
        'è¤‡é›œ': 'å¤æ‚',
        'ç°¡å–®': 'ç®€å•',
        'åŸºç¤': 'åŸºç¡€',
        'é€²éš': 'è¿›é˜¶',
        'é«˜ç´š': 'é«˜çº§',
        'å°ˆæ¥­': 'ä¸“ä¸š',
        'æ¨™æº–': 'æ ‡å‡†',
        'è‡ªè¨‚': 'è‡ªå®š',
        'å®¢è£½': 'å®šåˆ¶',
        'é€šç”¨': 'é€šç”¨',
        'ç‰¹å®š': 'ç‰¹å®š',
        'å°ˆç”¨': 'ä¸“ç”¨',
        'å…±ç”¨': 'å…±ç”¨',
        'ç§æœ‰': 'ç§æœ‰',
        'å…¬é–‹': 'å…¬å¼€',
        'å…§éƒ¨': 'å†…éƒ¨',
        'å¤–éƒ¨': 'å¤–éƒ¨',
        'æœ¬åœ°': 'æœ¬åœ°',
        'é ç«¯': 'è¿œç¨‹',
        'é›²ç«¯': 'äº‘ç«¯',
        'é‚Šç·£': 'è¾¹ç¼˜',
        'ä¸­å¿ƒ': 'ä¸­å¿ƒ',
        'åˆ†æ•£': 'åˆ†æ•£',
        'é›†ä¸­': 'é›†ä¸­',
        'èšåˆ': 'èšåˆ',
        'åˆ†é›¢': 'åˆ†ç¦»',
        'æ•´åˆ': 'æ•´åˆ',
        'èåˆ': 'èåˆ',
        'çµ±ä¸€': 'ç»Ÿä¸€',
        'æ¨™æº–åŒ–': 'æ ‡å‡†åŒ–',
        'è¦ç¯„åŒ–': 'è§„èŒƒåŒ–',
        'è‡ªå‹•åŒ–': 'è‡ªåŠ¨åŒ–',
        'æ™ºèƒ½åŒ–': 'æ™ºèƒ½åŒ–',
        'å¯è¦–åŒ–': 'å¯è§†åŒ–',
        'æ•¸å­—åŒ–': 'æ•°å­—åŒ–',
        'è™›æ“¬åŒ–': 'è™šæ‹ŸåŒ–',
        'å®¹å™¨åŒ–': 'å®¹å™¨åŒ–',
        'å¾®æœå‹™': 'å¾®æœåŠ¡',
        'ç„¡ä¼ºæœå™¨': 'æ— æœåŠ¡å™¨',
        'äº‹ä»¶é©…å‹•': 'äº‹ä»¶é©±åŠ¨',
        'è¨Šæ¯é©…å‹•': 'æ¶ˆæ¯é©±åŠ¨',
        'æ•¸æ“šé©…å‹•': 'æ•°æ®é©±åŠ¨',
        'æ¨¡å‹é©…å‹•': 'æ¨¡å‹é©±åŠ¨',
        'é ˜åŸŸé©…å‹•': 'é¢†åŸŸé©±åŠ¨',
        'æ¸¬è©¦é©…å‹•': 'æµ‹è¯•é©±åŠ¨',
        'è¡Œç‚ºé©…å‹•': 'è¡Œä¸ºé©±åŠ¨',
        'æ•æ·': 'æ•æ·',
        'ç€‘å¸ƒ': 'ç€‘å¸ƒ',
        'è¿­ä»£': 'è¿­ä»£',
        'å¢é‡': 'å¢é‡',
        'æŒçºŒ': 'æŒç»­',
        'æ•´åˆ': 'é›†æˆ',
        'äº¤ä»˜': 'äº¤ä»˜',
        'éƒ¨ç½²': 'éƒ¨ç½²',
        'ç™¼ä½ˆ': 'å‘å¸ƒ',
        'å›é¥‹': 'åé¦ˆ',
        'æ”¹å–„': 'æ”¹å–„',
        'å­¸ç¿’': 'å­¦ä¹ ',
        'æˆé•·': 'æˆé•¿',
        'é€²æ­¥': 'è¿›æ­¥',
        'çªç ´': 'çªç ´',
        'å‰µæ–°': 'åˆ›æ–°',
        'è®Šé©': 'å˜é©',
        'è½‰å‹': 'è½¬å‹',
        'æ¼”é€²': 'æ¼”è¿›',
        'é©å‘½': 'é©å‘½',
        'é¡›è¦†': 'é¢ è¦†',
        'é‡å¡‘': 'é‡å¡‘',
        'å†é€ ': 'å†é€ ',
        'å„ªå‹¢': 'ä¼˜åŠ¿',
        'åŠ£å‹¢': 'åŠ£åŠ¿',
        'æ©Ÿæœƒ': 'æœºä¼š',
        'å¨è„…': 'å¨èƒ',
        'æŒ‘æˆ°': 'æŒ‘æˆ˜',
        'å›°é›£': 'å›°éš¾',
        'éšœç¤™': 'éšœç¢',
        'ç“¶é ¸': 'ç“¶é¢ˆ',
        'é™åˆ¶': 'é™åˆ¶',
        'ç´„æŸ': 'çº¦æŸ',
        'ä¾è³´': 'ä¾èµ–',
        'è€¦åˆ': 'è€¦åˆ',
        'è§£è€¦': 'è§£è€¦',
        'å…§èš': 'å†…èš',
        'å°è£': 'å°è£…',
        'æŠ½è±¡': 'æŠ½è±¡',
        'ç¹¼æ‰¿': 'ç»§æ‰¿',
        'å¤šæ…‹': 'å¤šæ€',
        'æ¥å£': 'æ¥å£',
        'å¯¦ç¾': 'å®ç°',
        'æ“´å±•': 'æ‰©å±•',
        'çµ„åˆ': 'ç»„åˆ',
        'èšåˆ': 'èšåˆ',
        'é—œè¯': 'å…³è”',
        'ä¾è³´': 'ä¾èµ–',
        'æ³›åŒ–': 'æ³›åŒ–',
        'å¯¦ç¾': 'å®ç°',
        'åŒ…å«': 'åŒ…å«',
        'ä½¿ç”¨': 'ä½¿ç”¨',
        'å‰µå»º': 'åˆ›å»º',
        'éŠ·æ¯€': 'é”€æ¯',
        'åˆå§‹åŒ–': 'åˆå§‹åŒ–',
        'æ¸…ç†': 'æ¸…ç†',
        'å•Ÿå‹•': 'å¯åŠ¨',
        'é—œé–‰': 'å…³é—­',
        'æš«åœ': 'æš‚åœ',
        'æ¢å¾©': 'æ¢å¤',
        'åŸ·è¡Œ': 'æ‰§è¡Œ',
        'èª¿ç”¨': 'è°ƒç”¨',
        'è¿”å›': 'è¿”å›',
        'ç•°å¸¸': 'å¼‚å¸¸',
        'éŒ¯èª¤': 'é”™è¯¯',
        'è­¦å‘Š': 'è­¦å‘Š',
        'ä¿¡æ¯': 'ä¿¡æ¯',
        'èª¿è©¦': 'è°ƒè¯•',
        'è·Ÿè¹¤': 'è·Ÿè¸ª',
        'æ—¥èªŒ': 'æ—¥å¿—',
        'ç›£æ§': 'ç›‘æ§',
        'å‘Šè­¦': 'å‘Šè­¦',
        'é€šçŸ¥': 'é€šçŸ¥',
        'å ±å‘Š': 'æŠ¥å‘Š',
        'åˆ†æ': 'åˆ†æ',
        'çµ±è¨ˆ': 'ç»Ÿè®¡',
        'è¨ˆç®—': 'è®¡ç®—',
        'è™•ç†': 'å¤„ç†',
        'è½‰æ›': 'è½¬æ¢',
        'æ ¼å¼åŒ–': 'æ ¼å¼åŒ–',
        'è§£æ': 'è§£æ',
        'ç·¨ç¢¼': 'ç¼–ç ',
        'è§£ç¢¼': 'è§£ç ',
        'åŠ å¯†': 'åŠ å¯†',
        'è§£å¯†': 'è§£å¯†',
        'å£“ç¸®': 'å‹ç¼©',
        'è§£å£“': 'è§£å‹',
        'æ‰“åŒ…': 'æ‰“åŒ…',
        'è§£åŒ…': 'è§£åŒ…',
        'åºåˆ—åŒ–': 'åºåˆ—åŒ–',
        'ååºåˆ—åŒ–': 'ååºåˆ—åŒ–',
        'æŒä¹…åŒ–': 'æŒä¹…åŒ–',
        'ç·©å­˜': 'ç¼“å­˜',
        'å­˜å„²': 'å­˜å‚¨',
        'æª¢ç´¢': 'æ£€ç´¢',
        'æŸ¥è©¢': 'æŸ¥è¯¢',
        'æ›´æ–°': 'æ›´æ–°',
        'åˆªé™¤': 'åˆ é™¤',
        'æ’å…¥': 'æ’å…¥',
        'ä¿®æ”¹': 'ä¿®æ”¹',
        'æ›¿æ›': 'æ›¿æ¢',
        'åˆä½µ': 'åˆå¹¶',
        'åˆ†å‰²': 'åˆ†å‰²',
        'æˆªå–': 'æˆªå–',
        'æ‹¼æ¥': 'æ‹¼æ¥',
        'é€£æ¥': 'è¿æ¥',
        'æ–·é–‹': 'æ–­å¼€',
        'ç¶å®š': 'ç»‘å®š',
        'è§£ç¶': 'è§£ç»‘',
        'æ˜ å°„': 'æ˜ å°„',
        'è½‰æ›': 'è½¬æ¢',
        'éæ¿¾': 'è¿‡æ»¤',
        'æ’åº': 'æ’åº',
        'åˆ†çµ„': 'åˆ†ç»„',
        'èšåˆ': 'èšåˆ',
        'çµ±è¨ˆ': 'ç»Ÿè®¡',
        'è¨ˆç®—': 'è®¡ç®—',
        'æ¯”è¼ƒ': 'æ¯”è¾ƒ',
        'åŒ¹é…': 'åŒ¹é…',
        'æŸ¥æ‰¾': 'æŸ¥æ‰¾',
        'æ›¿æ›': 'æ›¿æ¢',
        'é©—è­‰': 'éªŒè¯',
        'æ ¡é©—': 'æ ¡éªŒ',
        'æª¢æŸ¥': 'æ£€æŸ¥',
        'æ¸¬è©¦': 'æµ‹è¯•',
        'è©•ä¼°': 'è¯„ä¼°',
        'åˆ¤æ–·': 'åˆ¤æ–­',
        'æ±ºå®š': 'å†³å®š',
        'é¸æ“‡': 'é€‰æ‹©',
        'åŸ·è¡Œ': 'æ‰§è¡Œ',
        'å¯¦æ–½': 'å®æ–½',
        'æ‡‰ç”¨': 'åº”ç”¨',
        'ä½¿ç”¨': 'ä½¿ç”¨',
        'é…ç½®': 'é…ç½®',
        'è¨­ç½®': 'è®¾ç½®',
        'èª¿æ•´': 'è°ƒæ•´',
        'å„ªåŒ–': 'ä¼˜åŒ–',
        'æ”¹é€²': 'æ”¹è¿›',
        'å¢å¼·': 'å¢å¼º',
        'æ“´å±•': 'æ‰©å±•',
        'å‡ç´š': 'å‡çº§',
        'æ›´æ–°': 'æ›´æ–°',
        'ç¶­è­·': 'ç»´æŠ¤',
        'ä¿®å¾©': 'ä¿®å¤',
        'ä¿®æ­£': 'ä¿®æ­£',
        'ç³¾æ­£': 'çº æ­£',
        'èª¿è©¦': 'è°ƒè¯•',
        'é™¤éŒ¯': 'é™¤é”™',
        'è¨ºæ–·': 'è¯Šæ–­',
        'åˆ†æ': 'åˆ†æ',
        'è©•ä¼°': 'è¯„ä¼°',
        'ç›£æ¸¬': 'ç›‘æµ‹',
        'è¿½è¹¤': 'è¿½è¸ª',
        'è¨˜éŒ„': 'è®°å½•',
        'å ±å‘Š': 'æŠ¥å‘Š',
        'é€šçŸ¥': 'é€šçŸ¥',
        'è­¦ç¤º': 'è­¦ç¤º',
        'æé†’': 'æé†’',
        'ç¢ºèª': 'ç¡®è®¤',
        'æ‰¹å‡†': 'æ‰¹å‡†',
        'æ‹’çµ•': 'æ‹’ç»',
        'å–æ¶ˆ': 'å–æ¶ˆ',
        'ä¸­æ­¢': 'ä¸­æ­¢',
        'çµ‚æ­¢': 'ç»ˆæ­¢',
        'å®Œæˆ': 'å®Œæˆ',
        'æˆåŠŸ': 'æˆåŠŸ',
        'å¤±æ•—': 'å¤±è´¥',
        'é‡è©¦': 'é‡è¯•',
        'å›æ»¾': 'å›æ»š',
        'æ¢å¾©': 'æ¢å¤',
        'å‚™ä»½': 'å¤‡ä»½',
        'é‚„åŸ': 'è¿˜åŸ',
        'åŒæ­¥': 'åŒæ­¥',
        'è¤‡è£½': 'å¤åˆ¶',
        'é·ç§»': 'è¿ç§»',
        'å°å‡º': 'å¯¼å‡º',
        'å°å…¥': 'å¯¼å…¥',
        'ä¸Šå‚³': 'ä¸Šä¼ ',
        'ä¸‹è¼‰': 'ä¸‹è½½',
        'ç™¼é€': 'å‘é€',
        'æ¥æ”¶': 'æ¥æ”¶',
        'å‚³è¼¸': 'ä¼ è¾“',
        'é€šä¿¡': 'é€šä¿¡',
        'äº¤äº’': 'äº¤äº’',
        'å”ä½œ': 'åä½œ',
        'å…±äº«': 'å…±äº«',
        'åˆ†äº«': 'åˆ†äº«',
        'ç™¼å¸ƒ': 'å‘å¸ƒ',
        'è¨‚é–±': 'è®¢é˜…',
        'æ¨é€': 'æ¨é€',
        'æ‹‰å–': 'æ‹‰å–',
        'åŒæ­¥': 'åŒæ­¥',
        'æ›´æ–°': 'æ›´æ–°',
        'åˆ·æ–°': 'åˆ·æ–°',
        'é‡è¼‰': 'é‡è½½',
        'é‡å•Ÿ': 'é‡å¯',
        'é‡ç½®': 'é‡ç½®',
        'æ¸…é™¤': 'æ¸…é™¤',
        'æ¸…ç†': 'æ¸…ç†',
        'é‡‹æ”¾': 'é‡Šæ”¾',
        'å›æ”¶': 'å›æ”¶',
        'éŠ·æ¯€': 'é”€æ¯',
        'å‰µå»º': 'åˆ›å»º',
        'ç”Ÿæˆ': 'ç”Ÿæˆ',
        'ç”¢ç”Ÿ': 'äº§ç”Ÿ',
        'å»ºç«‹': 'å»ºç«‹',
        'æ§‹å»º': 'æ„å»º',
        'ç·¨è­¯': 'ç¼–è¯‘',
        'éˆæ¥': 'é“¾æ¥',
        'æ‰“åŒ…': 'æ‰“åŒ…',
        'éƒ¨ç½²': 'éƒ¨ç½²',
        'å®‰è£': 'å®‰è£…',
        'å¸è¼‰': 'å¸è½½',
        'å•Ÿç”¨': 'å¯ç”¨',
        'ç¦ç”¨': 'ç¦ç”¨',
        'æ¿€æ´»': 'æ¿€æ´»',
        'åœç”¨': 'åœç”¨',
        'è¨»å†Š': 'æ³¨å†Œ',
        'è¨»éŠ·': 'æ³¨é”€',
        'ç™»å…¥': 'ç™»å½•',
        'ç™»å‡º': 'ç™»å‡º',
        'èªè­‰': 'è®¤è¯',
        'æˆæ¬Š': 'æˆæƒ',
        'é‘’æ¬Š': 'é‰´æƒ',
        'å¯©æ ¸': 'å®¡æ ¸',
        'æ‰¹å‡†': 'æ‰¹å‡†',
        'é§å›': 'é©³å›',
        'æ’¤éŠ·': 'æ’¤é”€',
        'å»¢æ£„': 'åºŸå¼ƒ',
        'æ­¸æª”': 'å½’æ¡£',
        'å­˜æª”': 'å­˜æ¡£',
        'å‚™ä»½': 'å¤‡ä»½',
        'å¿«ç…§': 'å¿«ç…§',
        'é¡åƒ': 'é•œåƒ',
        'è¤‡æœ¬': 'å‰¯æœ¬',
        'ä¸»å¾': 'ä¸»ä»',
        'ä¸»å‚™': 'ä¸»å¤‡',
        'é›™æ´»': 'åŒæ´»',
        'å¤šæ´»': 'å¤šæ´»',
        'å®¹ç½': 'å®¹ç¾',
        'å‚™æ´': 'å¤‡æ´',
        'åˆ‡æ›': 'åˆ‡æ¢',
        'æ•…éšœè½‰ç§»': 'æ•…éšœè½¬ç§»',
        'è² è¼‰å‡è¡¡': 'è´Ÿè½½å‡è¡¡',
        'æµé‡åˆ†é…': 'æµé‡åˆ†é…',
        'è·¯ç”±ç­–ç•¥': 'è·¯ç”±ç­–ç•¥',
        'æœå‹™ç™¼ç¾': 'æœåŠ¡å‘ç°',
        'å¥åº·æª¢æŸ¥': 'å¥åº·æ£€æŸ¥',
        'å¿ƒè·³æª¢æ¸¬': 'å¿ƒè·³æ£€æµ‹',
        'ç‹€æ…‹ç›£æ§': 'çŠ¶æ€ç›‘æ§',
        'æ€§èƒ½ç›£æ§': 'æ€§èƒ½ç›‘æ§',
        'æ—¥èªŒæ”¶é›†': 'æ—¥å¿—æ”¶é›†',
        'éˆè·¯è¿½è¹¤': 'é“¾è·¯è¿½è¸ª',
        'èª¿ç”¨éˆ': 'è°ƒç”¨é“¾',
        'ä¾è³´é—œä¿‚': 'ä¾èµ–å…³ç³»',
        'æ‹“æ’²åœ–': 'æ‹“æ‰‘å›¾',
        'æ¶æ§‹åœ–': 'æ¶æ„å›¾',
        'æµç¨‹åœ–': 'æµç¨‹å›¾',
        'æ™‚åºåœ–': 'æ—¶åºå›¾',
        'é¡åœ–': 'ç±»å›¾',
        'çµ„ä»¶åœ–': 'ç»„ä»¶å›¾',
        'éƒ¨ç½²åœ–': 'éƒ¨ç½²å›¾',
        'ç”¨ä¾‹åœ–': 'ç”¨ä¾‹å›¾',
        'æ´»å‹•åœ–': 'æ´»åŠ¨å›¾',
        'ç‹€æ…‹åœ–': 'çŠ¶æ€å›¾',
        'å”ä½œåœ–': 'åä½œå›¾',
        'åŒ…åœ–': 'åŒ…å›¾',
        'å°è±¡åœ–': 'å¯¹è±¡å›¾',
        'è¤‡åˆçµæ§‹åœ–': 'å¤åˆç»“æ„å›¾',
        'è¼ªå»“åœ–': 'è½®å»“å›¾',
        'äº¤äº’æ¦‚è¦½åœ–': 'äº¤äº’æ¦‚è§ˆå›¾',
        'æ™‚é–“åœ–': 'æ—¶é—´å›¾'
    }

    for old, new in corrections.items():
        text = text.replace(old, new)

    # æ·»åŠ æ ‡ç‚¹ç¬¦å·çš„ç©ºæ ¼ï¼ˆç”¨äºæ›´å¥½çš„åˆ†æ®µï¼‰
    text = re.sub(r'([ã€‚ï¼ï¼Ÿ])', r'\1 ', text)

    # åˆ†æ®µ
    sentences = re.split(r'[ã€‚ï¼ï¼Ÿ]\s*', text)

    # åˆå¹¶çŸ­å¥
    paragraphs = []
    current = []
    for sent in sentences:
        if sent.strip():
            current.append(sent.strip())
            # æ¯3-5å¥æˆ–è¶…è¿‡200å­—ç¬¦æˆæ®µ
            if len(current) >= 3 or sum(len(s) for s in current) > 200:
                paragraphs.append('ã€‚'.join(current) + 'ã€‚')
                current = []

    if current:
        paragraphs.append('ã€‚'.join(current) + 'ã€‚')

    return paragraphs

def detect_sections(paragraphs):
    """æ£€æµ‹æ–‡æ¡£çš„ä¸»è¦ç« èŠ‚"""
    sections = []
    current_section = None
    current_content = []

    keywords = {
        'ä»‹ç»': ['é¦–å…ˆ', 'ä»€ä¹ˆæ˜¯', 'å®šä¹‰', 'æ¦‚å¿µ', 'ç®€å•æ¥è¯´'],
        'èƒŒæ™¯': ['èƒŒæ™¯', 'åŸå› ', 'ä¸ºä»€ä¹ˆ', 'é—®é¢˜æ˜¯'],
        'åŸç†': ['åŸç†', 'å·¥ä½œæœºåˆ¶', 'å¦‚ä½•å·¥ä½œ', 'å®ç°æ–¹å¼'],
        'å®ç°': ['å®ç°', 'ä»£ç ', 'æ­¥éª¤', 'æ–¹æ³•', 'æŠ€æœ¯'],
        'ä¾‹å­': ['ä¾‹å¦‚', 'æ¯”å¦‚', 'ä¸¾ä¾‹', 'æ¡ˆä¾‹', 'åœºæ™¯'],
        'æ€»ç»“': ['æ€»ç»“', 'æ€»çš„æ¥è¯´', 'æœ€å', 'ä»Šå¤©çš„'],
        'æ¨è': ['å»ºè®®', 'æ¨è', 'å‚è€ƒ', 'æ–‡ç« '],
    }

    for para in paragraphs:
        section_found = False
        for section_name, section_keywords in keywords.items():
            if any(kw in para for kw in section_keywords):
                if current_section:
                    sections.append((current_section, current_content))
                current_section = section_name
                current_content = [para]
                section_found = True
                break

        if not section_found and current_section:
            current_content.append(para)
        elif not section_found:
            if not current_section:
                current_section = 'å¼•è¨€'
            current_content.append(para)

    if current_section:
        sections.append((current_section, current_content))

    return sections

def convert_to_markdown(input_file, output_file):
    """å°†å•ä¸ªtxtæ–‡ä»¶è½¬æ¢ä¸ºmarkdown"""
    with open(input_file, 'r', encoding='utf-8') as f:
        text = f.read()

    # è·å–è§†é¢‘æ ‡é¢˜
    lines = text.split('\n')
    title = lines[0].replace('è§†é¢‘: ', '').replace('.mp4', '') if lines[0].startswith('è§†é¢‘:') else Path(input_file).stem

    # æ¸…ç†å’Œåˆ†æ®µ
    paragraphs = clean_and_segment_text(text)

    # æ£€æµ‹ç« èŠ‚
    sections = detect_sections(paragraphs)

    # æ„å»ºMarkdown
    md_content = f"# {title}\n\n"

    for section_name, section_content in sections:
        if section_name != 'å¼•è¨€':
            md_content += f"## {section_name}\n\n"

        for para in section_content:
            md_content += f"{para}\n\n"

    # ä¿å­˜æ–‡ä»¶
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(md_content)

    print(f"âœ… è½¬æ¢å®Œæˆ: {output_file}")

def main():
    input_dir = Path("storage/results/mark_transcripts")
    output_dir = Path("storage/results/mark_transcripts/markdown")
    output_dir.mkdir(exist_ok=True)

    txt_files = list(input_dir.glob("*.txt"))
    print(f"ğŸ“š æ‰¾åˆ° {len(txt_files)} ä¸ªtxtæ–‡ä»¶å¾…è½¬æ¢")

    for txt_file in txt_files:
        output_file = output_dir / f"{txt_file.stem}.md"
        try:
            convert_to_markdown(txt_file, output_file)
        except Exception as e:
            print(f"âŒ è½¬æ¢å¤±è´¥ {txt_file}: {e}")

if __name__ == "__main__":
    main()