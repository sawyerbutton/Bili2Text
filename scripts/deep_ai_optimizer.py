#!/usr/bin/env python3
"""
深度AI文档优化器
使用迭代方式对每个文档进行深度优化
"""

import os
import sys
from pathlib import Path
import re
from typing import List, Dict, Tuple

class DeepDocumentOptimizer:
    def __init__(self):
        self.tech_terms = self._load_tech_terms()

    def _load_tech_terms(self) -> Dict[str, List[str]]:
        """加载技术术语字典"""
        return {
            # 核心AI概念
            'Agent': ['agent', 'H', '艾真特', '爱近特', 'AGENT'],
            'Token': ['token', '偷懇', '投肯', '拖肯', 'TOKEN'],
            'Context': ['context', '康特斯特', 'CONTEXT'],
            'Context Window': ['context window', '上下文窗口', '上下輪窗口'],
            'Context Engineering': ['Context Engineering', 'Context and Engineering', '上下文工程'],

            # 协议和标准
            'A2A协议': ['A2A', 'a2a', 'Agent to Agent', 'HUA协议', 'HAA协议'],
            'MCP': ['MCP', 'mcp', 'Model Context Protocol', 'FCP'],
            'Function Calling': ['Function Calling', '方克森靠0', '函数调用'],
            'JSON-RPC': ['JSON-RPC', 'JSAN RPC', 'JSYRPC'],

            # 大模型
            'GPT': ['GPT', 'gpt', 'GPD', 'GPTD'],
            'Claude': ['Claude', 'Cloud', 'CLOUD', '克劳德'],
            'ChatGPT': ['ChatGPT', 'Chaggbt', 'Chat GPT', 'ChagGBT'],
            'Gemini': ['Gemini', 'GEMON', 'JAMMDR', 'Gemma', 'Jammy'],
            'DeepSeek': ['DeepSeek', 'DipSync', 'Deepseek', 'DeepSeep'],

            # 技术组件
            'RAG': ['RAG', 'rag', 'Rag', '检索增强生成'],
            'Artifact': ['Artifact', 'artifact', 'RDFACT', 'Artifacts'],
            'Multi-Agent': ['Multi-Agent', 'multi-agent', 'MALSEAZEN', 'Mouth Agents', 'MaltzAgent'],
            'streaming': ['streaming', 'SREEM', 'stream', '流式', '流氏'],
            'Agent Card': ['Agent Card', 'agent card', 'AgentCard'],

            # 开发工具
            'API': ['API', 'api'],
            'SDK': ['SDK', 'sdk'],
            'HTTP': ['HTTP', 'HTDP', 'HDDP', 'http'],
            'URL': ['URL', 'url', 'UIR', 'UR', 'URLs'],
            'localhost': ['localhost', 'Local Host', 'local host'],
            'JSON': ['JSON', 'json', 'JSAN', '遍上', 'JS ON'],
            'Base64': ['Base64', 'base64'],

            # 工具和框架
            'Cline': ['Cline', 'Colline', '克莱恩'],
            'Cursor': ['Cursor', 'cursor', '光标'],
            'Wireshark': ['Wireshark', 'WarShark', 'wareshark', 'War shark'],
            'LangChain': ['LangChain', '狼Cin', 'langchain', '狼治癮'],
            'uv': ['uv', 'UV', '拍赏的包观里器', '包管理器'],

            # 公司和组织
            'Google': ['Google', 'google', '谷歌'],
            'Anthropic': ['Anthropic', 'Anthorapic'],
            'OpenAI': ['OpenAI', 'openai', 'Open AI'],

            # 中文修正
            '输入': ['输入', '書入', '书入', '输人'],
            '输出': ['输出', '輸出', '输山'],
            '返回': ['返回', '反回', '版回', '返回', '发挥'],
            '调用': ['调用', '電影', '电影', '吊用'],
            '函数': ['函数', '韓數', '寒数', '涵数'],
            '消息': ['消息', 'Message', 'message', 'Massage'],
            '请求': ['请求', '請求', '清求'],
            '响应': ['响应', '響應', '相应'],
            '参数': ['参数', '參數', 'Params', 'PARMS'],
            '属性': ['属性', '屬性', '树形'],
            '协议': ['协议', '協議'],
            '服务': ['服务', '服務', '福气'],
            '客户': ['客户', '客戶', '客服'],
            '模型': ['模型', '模形'],
            '工具': ['工具', '共具'],
            '用户': ['用户', '用戶', '用呼', '拥护'],
            '问题': ['问题', '問題'],
            '方法': ['方法', 'method', 'Method', 'MAS and'],
            '结果': ['结果', '結果', 'Results', 'results'],
            '任务': ['任务', '任務', 'Task', 'task'],
            '历史': ['历史', '歷史', 'History', 'history'],
            '状态': ['状态', '狀態', 'Status', 'status', 'State'],
            '完成': ['完成', 'completed', 'Complicated'],
            '端口': ['端口', 'port', '段口', '段口号'],
            '格式化': ['格式化', '格式华'],
            '筛选': ['筛选', '摔眩', '摔雪'],
            '注册': ['注册', '诸测', '註冊'],
            '启动': ['启动', '啟動', '起动'],
            '天气': ['天气', '天氣', '天鞋'],
            '机票': ['机票', '機票', '机票'],
            '调度': ['调度', '調度', '吊度'],
            '创建': ['创建', '創建', '创见'],
            '平台': ['平台', '平臺', '平太'],
            '列表': ['列表', '列錶', '利表'],
            '角色': ['角色', '角式'],
            '查询': ['查询', '查詢', '查寻'],
            '信息': ['信息', '資訊', '资讯'],
            '版本': ['版本', 'version', 'Virgin'],
            '功能': ['功能', '攻能'],
            '技能': ['技能', 'skills', 'scales'],
            '描述': ['描述', 'description'],
            '名称': ['名称', 'name'],
            '标签': ['标签', 'tags', 'text'],
            '流程': ['流程', '流成'],
            '系统': ['系统', '系統', '细统'],
            '设计': ['设计', '設計', '射击'],
            '实现': ['实现', '實現', '实线'],
            '处理': ['处理', '處理', '出理'],
            '分析': ['分析', '分息'],
            '执行': ['执行', '執行', '知行'],
            '运行': ['运行', '運行', '云形'],
            '配置': ['配置', '培植'],
            '环境': ['环境', '環境', '环景'],
            '测试': ['测试', '測試', '侧试'],
            '调试': ['调试', '調試', '调室'],
            '部署': ['部署', '不书'],
            '文件': ['文件', '文建'],
            '目录': ['目录', '牧路', '母录'],
            '路径': ['路径', '路劲'],
            '节点': ['节点', '節點', '借点'],
            '网络': ['网络', '網絡', '网罗'],
            '接口': ['接口', '街口'],
            '数据': ['数据', '數據', '树具'],
            '存储': ['存储', '存儲', '存触'],
            '缓存': ['缓存', '緩存', '环存'],
            '队列': ['队列', '隊列', '堆列'],
            '连接': ['连接', '連接', '联接'],
            '监控': ['监控', '監控', '见控'],
            '日志': ['日志', '日誌', '日质'],
            '错误': ['错误', '錯誤', '措误'],
            '异常': ['异常', '異常', '一场'],
            '成功': ['成功', '成攻'],
            '失败': ['失败', '失敗', '失拜'],
            '优化': ['优化', '優化', '油画'],
            '性能': ['性能', '行能'],
            '效率': ['效率', '笑率'],
            '安全': ['安全', '按全'],
            '权限': ['权限', '權限', '券限'],
            '认证': ['认证', '認證', '人正'],
            '授权': ['授权', '授權', '受权'],
            '加密': ['加密', '家密'],
            '解密': ['解密', '截密'],
            '备份': ['备份', '備份', '背份'],
            '恢复': ['恢复', '恢復', '回复'],
            '更新': ['更新', '工薪'],
            '升级': ['升级', '升級', '生机'],
            '维护': ['维护', '維護', '围护'],
            '管理': ['管理', '馆里'],
            '控制': ['控制', '控製', '空置'],
            '监听': ['监听', '監聽', '见听'],
            '触发': ['触发', '觸發', '出发'],
            '回调': ['回调', '回調', '回吊'],
            '事件': ['事件', '是件'],
            '处理器': ['处理器', '處理器', '出理器'],
            '中间件': ['中间件', '中間件', '中建件'],
            '插件': ['插件', '差件'],
            '模块': ['模块', '模塊', '魔快'],
            '组件': ['组件', '組件', '族件'],
            '服务器': ['服务器', '服務器', '福气器'],
            '客户端': ['客户端', '客戶端', '客服端'],
            '数据库': ['数据库', '數據庫', '树具库'],
            '缓存': ['缓存', '緩存', '环存'],
            '队列': ['队列', '隊列', '堆列'],
            '消息': ['消息', '小西'],
            '通道': ['通道', '通到'],
            '会话': ['会话', '會話', '汇化'],
            '链接': ['链接', '鏈接', '连结'],
            '节点': ['节点', '節點', '借点'],
            '集群': ['集群', '急群'],
            '负载': ['负载', '負載', '服在'],
            '均衡': ['均衡', '军衡'],
            '容错': ['容错', '容錯', '融错'],
            '备援': ['备援', '備援', '背元'],
            '灾备': ['灾备', '災備', '在背'],
            '迁移': ['迁移', '遷移', '千一'],
            '复制': ['复制', '複製', '父置'],
            '快照': ['快照', '块照'],
            '镜像': ['镜像', '鏡像', '境向'],
            '克隆': ['克隆', '克龙'],
            '分支': ['分支', '分之'],
            '合并': ['合并', '合併', '和病'],
            '冲突': ['冲突', '衝突', '充土'],
            '解决': ['解决', '解決', '截决'],
            '提交': ['提交', '提較'],
            '推送': ['推送', '推松'],
            '拉取': ['拉取', '拉曲'],
            '同步': ['同步', '同不'],
            '标签': ['标签', '標籤', '表浅'],
            '发布': ['发布', '發布', '发不'],
            '构建': ['构建', '構建', '够见'],
            '编译': ['编译', '編譯', '边一'],
            '打包': ['打包', '打报'],
            '调试': ['调试', '調試', '吊试'],
            '优化': ['优化', '優化', '有话'],
            '性能': ['性能', '兴能'],
            '监控': ['监控', '監控', '见空'],
            '日志': ['日志', '日誌', '日直'],
            '追踪': ['追踪', '追蹤', '追中'],
            '分析': ['分析', '分西'],
            '报表': ['报表', '報表', '报标'],
            '仪表板': ['仪表板', '儀表板', '一表板'],
            '可视化': ['可视化', '可視化', '科室化'],
            '图表': ['图表', '圖表', '图标'],
            '统计': ['统计', '統計', '通记'],
            '指标': ['指标', '指標', '之表'],
            '阈值': ['阈值', '閾值', '与值'],
            '告警': ['告警', '高警'],
            '通知': ['通知', '通直'],
            '邮件': ['邮件', '郵件', '有件'],
            '短信': ['短信', '短訊', '端信'],
            '订阅': ['订阅', '訂閱', '定月'],
            '用户': ['用户', '用戶', '用护'],
            '角色': ['角色', '脚色'],
            '权限': ['权限', '權限', '全线'],
            '群组': ['群组', '群組', '群族'],
            '组织': ['组织', '組織', '族织'],
            '团队': ['团队', '團隊', '团对'],
            '项目': ['项目', '項目', '像目'],
            '任务': ['任务', '任務', '人物'],
            '工单': ['工单', '工單', '工但'],
            '需求': ['需求', '须求'],
            '缺陷': ['缺陷', '缺线'],
            '改进': ['改进', '改進', '该进'],
            '优化': ['优化', '優化', '有话'],
            '重构': ['重构', '重構', '重够'],
            '迁移': ['迁移', '遷移', '千一'],
            '升级': ['升级', '升級', '生机'],
            '维护': ['维护', '維護', '伟护'],
            '支持': ['支持', '支援', '之池'],
            '服务': ['服务', '服務', '福物'],
            '协助': ['协助', '協助', '些主'],
            '帮助': ['帮助', '幫助', '棒主'],
            '文档': ['文档', '文檔', '问当'],
            '手册': ['手册', '手冊', '手侧', '手側'],
            '指南': ['指南', '之难'],
            '教程': ['教程', '叫成'],
            '示例': ['示例', '示立', '式力'],
            '模板': ['模板', '魔板'],
            '框架': ['框架', '框加'],
            '套件': ['套件', '套建'],
            '依赖': ['依赖', '依賴', '一来'],
            '兼容': ['兼容', '相容', '间容'],
            '版本': ['版本', '版笨'],
            '更新': ['更新', '更心'],
            '修补': ['修补', '修補', '休不'],
            '补丁': ['补丁', '補丁', '不定'],
            '热修复': ['热修复', '熱修復', '热休复'],
            '回滚': ['回滚', '回滾', '回棍'],
            '还原': ['还原', '還原', '换元'],
            '撤销': ['撤销', '撤銷', '车小'],
            '重做': ['重做', '重作', '重左'],
            '历史': ['历史', '歷史', '厉师'],
            '记录': ['记录', '記錄', '机路'],
            '审计': ['审计', '審計', '深记'],
            '合规': ['合规', '合規', '和规'],
            '安全': ['安全', '按全'],
            '漏洞': ['漏洞', '漏东'],
            '威胁': ['威胁', '威脅', '为写'],
            '风险': ['风险', '風險', '分线'],
            '评估': ['评估', '評估', '平谷'],
            '缓解': ['缓解', '緩解', '环节'],
            '修复': ['修复', '修復', '休府'],
            '防护': ['防护', '防護', '方互'],
            '检测': ['检测', '檢測', '简测'],
            '扫描': ['扫描', '掃描', '散苗'],
            '监测': ['监测', '監測', '见测'],
            '预警': ['预警', '預警', '与警'],
            '应急': ['应急', '應急', '因机'],
            '恢复': ['恢复', '恢復', '会府'],
            '切换': ['切换', '切換', '且换'],
            '容灾': ['容灾', '容災', '融灾'],
            '高可用': ['高可用', '高科用'],
            '负载均衡': ['负载均衡', '負載均衡', '服在军衡'],
            '自动扩展': ['自动扩展', '自動擴展', '字动扩战'],
            '弹性伸缩': ['弹性伸缩', '彈性伸縮', '但性生所'],
            '资源': ['资源', '資源', '字元'],
            '配额': ['配额', '配額', '陪饿'],
            '限制': ['限制', '线止'],
            '约束': ['约束', '約束', '月数'],
            '规则': ['规则', '規則', '柜则'],
            '策略': ['策略', '策罗'],
            '算法': ['算法', '演算法', '酸法'],
            '逻辑': ['逻辑', '邏輯', '罗集'],
            '流程': ['流程', '流成'],
            '步骤': ['步骤', '步驟', '不奏'],
            '阶段': ['阶段', '階段', '接断'],
            '转换': ['转换', '轉換', '专换'],
            '条件': ['条件', '條件', '调件'],
            '判断': ['判断', '判斷', '盘断'],
            '决策': ['决策', '決策', '绝测'],
            '选择': ['选择', '選擇', '宣则'],
            '路由': ['路由', '路有'],
            '分发': ['分发', '分發', '分法'],
            '调度': ['调度', '調度', '吊度'],
            '排程': ['排程', '排成'],
            '优先级': ['优先级', '優先級', '有线机'],
            '权重': ['权重', '權重', '全中'],
            '平衡': ['平衡', '平很'],
            '优化': ['优化', '優化', '有话'],
            '调优': ['调优', '調優', '吊有'],
            '性能': ['性能', '兴能'],
            '吞吐': ['吞吐', '吞土'],
            '延迟': ['延迟', '延遲', '严池'],
            '响应': ['响应', '響應', '相应'],
            '并发': ['并发', '併發', '病法'],
            '同时': ['同时', '同時', '通识'],
            '顺序': ['顺序', '順序', '顺续'],
            '有序': ['有序', '有续'],
            '无序': ['无序', '無序', '无续'],
            '同步': ['同步', '通不'],
            '异步': ['异步', '異步', '一不'],
            '阻塞': ['阻塞', '族塞'],
            '非阻塞': ['非阻塞', '非族塞'],
            '超时': ['超时', '超時', '超识'],
            '重试': ['重试', '重試', '重识'],
            '回退': ['回退', '回腿'],
            '降级': ['降级', '降級', '降机'],
            '熔断': ['熔断', '熔斷', '融断'],
            '限流': ['限流', '线流'],
            '排队': ['排队', '排隊', '排对'],
            '缓冲': ['缓冲', '緩衝', '环充'],
            '批次': ['批次', '批此'],
            '批量': ['批量', '批梁'],
            '单一': ['单一', '單一', '但一'],
            '多重': ['多重', '多种'],
            '复杂': ['复杂', '複雜', '父杂'],
            '简单': ['简单', '簡單', '简但'],
            '基础': ['基础', '基礎', '机楚'],
            '进阶': ['进阶', '進階', '晋接'],
            '高级': ['高级', '高級', '高机'],
            '专业': ['专业', '專業', '专也'],
            '标准': ['标准', '標準', '表准'],
            '自定': ['自定', '自訂', '字定'],
            '定制': ['定制', '定製', '定至'],
            '通用': ['通用', '通永'],
            '特定': ['特定', '特顶'],
            '专用': ['专用', '專用', '专永'],
            '共用': ['共用', '共永'],
            '私有': ['私有', '私友'],
            '公开': ['公开', '公開', '工开'],
            '内部': ['内部', '內部', '内不'],
            '外部': ['外部', '外不'],
            '本地': ['本地', '本低'],
            '远程': ['远程', '遠程', '远成'],
            '云端': ['云端', '雲端', '云但'],
            '边缘': ['边缘', '邊緣', '边源'],
            '中心': ['中心', '中欣'],
            '分散': ['分散', '分三'],
            '集中': ['集中', '集种'],
            '聚合': ['聚合', '聚和'],
            '分离': ['分离', '分離', '分力'],
            '整合': ['整合', '整和'],
            '融合': ['融合', '融和'],
            '统一': ['统一', '統一', '通一'],
            '标准化': ['标准化', '標準化', '表准化'],
            '规范化': ['规范化', '規範化', '柜范化'],
            '自动化': ['自动化', '自動化', '字动化'],
            '智能化': ['智能化', '之能化'],
            '可视化': ['可视化', '可視化', '科室化'],
            '数字化': ['数字化', '數字化', '书子化'],
            '虚拟化': ['虚拟化', '虛擬化', '虚拟画'],
            '容器化': ['容器化', '容气化'],
            '微服务': ['微服务', '微服務', '微福物'],
            '无服务器': ['无服务器', '無伺服器', '无福物器'],
            '事件驱动': ['事件驱动', '事件驅動', '是件去动'],
            '消息驱动': ['消息驱动', '訊息驅動', '小西去动'],
            '数据驱动': ['数据驱动', '數據驅動', '树具去动'],
            '模型驱动': ['模型驱动', '模型驅動', '模形去动'],
            '领域驱动': ['领域驱动', '領域驅動', '零于去动'],
            '测试驱动': ['测试驱动', '測試驅動', '测试去动'],
            '行为驱动': ['行为驱动', '行為驅動', '行为去动'],
            '敏捷': ['敏捷', '民接'],
            '瀑布': ['瀑布', '破不'],
            '迭代': ['迭代', '碟带'],
            '增量': ['增量', '增亮'],
            '持续': ['持续', '持續', '池续'],
            '集成': ['集成', '集成', '急成', '整合'],
            '交付': ['交付', '交府'],
            '部署': ['部署', '部书'],
            '发布': ['发布', '發布', '发不'],
            '反馈': ['反馈', '反饋', '返会', '回饋'],
            '改善': ['改善', '改山'],
            '学习': ['学习', '學習', '学西'],
            '成长': ['成长', '成長', '成张'],
            '进步': ['进步', '進步', '晋不'],
            '突破': ['突破', '突坡'],
            '创新': ['创新', '創新', '创心'],
            '变革': ['变革', '變革', '变格'],
            '转型': ['转型', '轉型', '专兴'],
            '演进': ['演进', '演進', '演晋'],
            '革命': ['革命', '格明'],
            '颠覆': ['颠覆', '顛覆', '颠府'],
            '重塑': ['重塑', '重数'],
            '再造': ['再造', '再早'],
            '优势': ['优势', '優勢', '有势'],
            '劣势': ['劣势', '劣勢', '烈势'],
            '机会': ['机会', '機會', '机汇'],
            '威胁': ['威胁', '威脅', '为写'],
            '挑战': ['挑战', '挑戰', '挑站'],
            '困难': ['困难', '困難', '困南'],
            '障碍': ['障碍', '障礙', '障爱'],
            '瓶颈': ['瓶颈', '瓶頸', '瓶井'],
            '限制': ['限制', '线止'],
            '约束': ['约束', '約束', '月数'],
            '依赖': ['依赖', '依賴', '一来'],
            '耦合': ['耦合', '偶和'],
            '解耦': ['解耦', '截偶'],
            '内聚': ['内聚', '內聚', '内局'],
            '封装': ['封装', '封裝', '风装'],
            '抽象': ['抽象', '抽像'],
            '继承': ['继承', '繼承', '记成'],
            '多态': ['多态', '多態', '多太'],
            '接口': ['接口', '街口'],
            '实现': ['实现', '實現', '实线'],
            '扩展': ['扩展', '擴展', '扩战'],
            '组合': ['组合', '組合', '族和'],
            '聚合': ['聚合', '聚和'],
            '关联': ['关联', '關聯', '官连'],
            '泛化': ['泛化', '繁化'],
            '包含': ['包含', '包汉'],
            '使用': ['使用', '使永'],
            '创建': ['创建', '創建', '创见'],
            '销毁': ['销毁', '銷毀', '小会'],
            '初始化': ['初始化', '初始画'],
            '清理': ['清理', '青理'],
            '启动': ['启动', '啟動', '起动'],
            '关闭': ['关闭', '關閉', '官比'],
            '暂停': ['暂停', '暫停', '占停'],
            '恢复': ['恢复', '恢復', '灰府'],
            '执行': ['执行', '執行', '知行'],
            '调用': ['调用', '調用', '吊永'],
            '返回': ['返回', '反会'],
            '异常': ['异常', '異常', '一场'],
            '错误': ['错误', '錯誤', '错五'],
            '警告': ['警告', '警高'],
            '信息': ['信息', '信西'],
            '调试': ['调试', '調試', '吊识'],
            '跟踪': ['跟踪', '跟蹤', '根中'],
            '日志': ['日志', '日誌', '日直'],
            '监控': ['监控', '監控', '见空'],
            '告警': ['告警', '高警'],
            '通知': ['通知', '通直'],
            '报告': ['报告', '報告', '报高'],
            '分析': ['分析', '分西'],
            '统计': ['统计', '統計', '通机'],
            '计算': ['计算', '計算', '记酸'],
            '处理': ['处理', '處理', '出力'],
            '转换': ['转换', '轉換', '专换'],
            '格式化': ['格式化', '格式华'],
            '解析': ['解析', '截西'],
            '编码': ['编码', '編碼', '边马'],
            '解码': ['解码', '解碼', '截马'],
            '加密': ['加密', '加迷'],
            '解密': ['解密', '截迷'],
            '压缩': ['压缩', '壓縮', '压所'],
            '解压': ['解压', '解壓', '截压'],
            '打包': ['打包', '打报'],
            '解包': ['解包', '截包'],
            '序列化': ['序列化', '序列画'],
            '反序列化': ['反序列化', '反序列画'],
            '持久化': ['持久化', '池久化'],
            '缓存': ['缓存', '緩存', '环存'],
            '存储': ['存储', '存儲', '存处'],
            '检索': ['检索', '檢索', '简所'],
            '查询': ['查询', '查詢', '查寻'],
            '更新': ['更新', '更心'],
            '删除': ['删除', '刪除', '山除'],
            '插入': ['插入', '差入'],
            '修改': ['修改', '休盖'],
            '替换': ['替换', '替換', '替换'],
            '合并': ['合并', '合併', '和病'],
            '分割': ['分割', '分个'],
            '截取': ['截取', '截曲'],
            '拼接': ['拼接', '拼接'],
            '连接': ['连接', '連接', '连结'],
            '断开': ['断开', '斷開', '断开'],
            '绑定': ['绑定', '綁定', '棒定'],
            '解绑': ['解绑', '解綁', '截棒'],
            '映射': ['映射', '映社'],
            '转换': ['转换', '轉換', '专换'],
            '过滤': ['过滤', '過濾', '过率'],
            '排序': ['排序', '排续'],
            '分组': ['分组', '分組', '分族'],
            '聚合': ['聚合', '聚和'],
            '统计': ['统计', '統計', '通机'],
            '计算': ['计算', '計算', '记酸'],
            '比较': ['比较', '比較', '比脚'],
            '匹配': ['匹配', '匹陪'],
            '查找': ['查找', '查照'],
            '替换': ['替换', '替換', '提换'],
            '验证': ['验证', '驗證', '烟正'],
            '校验': ['校验', '校驗', '小烟'],
            '检查': ['检查', '檢查', '简查'],
            '测试': ['测试', '測試', '测识'],
            '评估': ['评估', '評估', '平谷'],
            '判断': ['判断', '判斷', '盘断'],
            '决定': ['决定', '決定', '绝顶'],
            '选择': ['选择', '選擇', '宣择'],
            '执行': ['执行', '執行', '知行'],
            '实施': ['实施', '實施', '实识'],
            '应用': ['应用', '應用', '应永'],
            '使用': ['使用', '使永'],
            '配置': ['配置', '配至'],
            '设置': ['设置', '設置', '射至'],
            '调整': ['调整', '調整', '吊正'],
            '优化': ['优化', '優化', '有话'],
            '改进': ['改进', '改進', '改晋'],
            '增强': ['增强', '增強', '增抢'],
            '扩展': ['扩展', '擴展', '扩战'],
            '升级': ['升级', '升級', '生机'],
            '更新': ['更新', '更心'],
            '维护': ['维护', '維護', '为护'],
            '修复': ['修复', '修復', '休府'],
            '修正': ['修正', '休正'],
            '纠正': ['纠正', '糾正', '叫正'],
            '调试': ['调试', '調試', '吊识'],
            '除错': ['除错', '除錯', '初错'],
            '诊断': ['诊断', '診斷', '枕断'],
            '分析': ['分析', '分西'],
            '评估': ['评估', '評估', '平谷'],
            '监测': ['监测', '監測', '见测'],
            '追踪': ['追踪', '追蹤', '追中'],
            '记录': ['记录', '記錄', '机路'],
            '报告': ['报告', '報告', '报高'],
            '通知': ['通知', '通直'],
            '警示': ['警示', '警识'],
            '提醒': ['提醒', '提星'],
            '确认': ['确认', '確認', '缺人'],
            '批准': ['批准', '批准', '皮准'],
            '拒绝': ['拒绝', '拒絕', '拒接'],
            '取消': ['取消', '取小'],
            '中止': ['中止', '种止'],
            '终止': ['终止', '終止', '中止'],
            '完成': ['完成', '完陈'],
            '成功': ['成功', '成公'],
            '失败': ['失败', '失敗', '失拜'],
            '重试': ['重试', '重試', '重识'],
            '回滚': ['回滚', '回滾', '回棍'],
            '恢复': ['恢复', '恢復', '灰府'],
            '备份': ['备份', '備份', '背份'],
            '还原': ['还原', '還原', '换元'],
            '同步': ['同步', '通不'],
            '复制': ['复制', '複製', '父至'],
            '迁移': ['迁移', '遷移', '千一'],
            '导出': ['导出', '導出', '倒出', '匯出'],
            '导入': ['导入', '導入', '倒入', '匯入'],
            '上传': ['上传', '上傳', '上船'],
            '下载': ['下载', '下載', '下在'],
            '发送': ['发送', '發送', '发松'],
            '接收': ['接收', '接受', '截收'],
            '传输': ['传输', '傳輸', '船书'],
            '通信': ['通信', '通讯', '通心'],
            '交互': ['交互', '交护'],
            '协作': ['协作', '協作', '些座'],
            '共享': ['共享', '共想'],
            '分享': ['分享', '分想'],
            '发布': ['发布', '發布', '发不'],
            '订阅': ['订阅', '訂閱', '定月'],
            '推送': ['推送', '推松'],
            '拉取': ['拉取', '拉曲'],
            '同步': ['同步', '通不'],
            '更新': ['更新', '更心'],
            '刷新': ['刷新', '刷心'],
            '重载': ['重载', '重載', '重在'],
            '重启': ['重启', '重啟', '重起'],
            '重置': ['重置', '重至'],
            '清除': ['清除', '清初'],
            '清理': ['清理', '青理'],
            '释放': ['释放', '釋放', '是放'],
            '回收': ['回收', '回首'],
            '销毁': ['销毁', '銷毀', '小会'],
            '创建': ['创建', '創建', '创见'],
            '生成': ['生成', '生陈'],
            '产生': ['产生', '產生', '产升'],
            '建立': ['建立', '建里'],
            '构建': ['构建', '構建', '够见'],
            '编译': ['编译', '編譯', '边一'],
            '链接': ['链接', '鏈接', '连结'],
            '打包': ['打包', '打报'],
            '部署': ['部署', '部书'],
            '安装': ['安装', '安裝', '安庄'],
            '卸载': ['卸载', '卸載', '谢在'],
            '启用': ['启用', '啟用', '起永'],
            '禁用': ['禁用', '禁永'],
            '激活': ['激活', '急活'],
            '停用': ['停用', '停永'],
            '注册': ['注册', '註冊', '注测'],
            '注销': ['注销', '註銷', '注小'],
            '登录': ['登录', '登入', '登路'],
            '登出': ['登出', '登初'],
            '认证': ['认证', '認證', '人正'],
            '授权': ['授权', '授權', '受券'],
            '鉴权': ['鉴权', '鑒權', '见券'],
            '审核': ['审核', '審核', '深河'],
            '批准': ['批准', '批准', '皮准'],
            '驳回': ['驳回', '駁回', '博会'],
            '撤销': ['撤销', '撤銷', '车小'],
            '废弃': ['废弃', '廢棄', '飞齐'],
            '归档': ['归档', '歸檔', '柜当'],
            '存档': ['存档', '存檔', '存当'],
            '备份': ['备份', '備份', '背份'],
            '快照': ['快照', '快招'],
            '镜像': ['镜像', '鏡像', '境向'],
            '副本': ['副本', '複本', '府笨'],
            '主从': ['主从', '主從', '主充'],
            '主备': ['主备', '主備', '主背'],
            '双活': ['双活', '雙活', '双或'],
            '多活': ['多活', '多或'],
            '容灾': ['容灾', '容災', '融灾'],
            '备援': ['备援', '備援', '背元'],
            '切换': ['切换', '切換', '且换'],
            '故障转移': ['故障转移', '故障轉移', '故障专一'],
            '负载均衡': ['负载均衡', '負載均衡', '服在军衡'],
            '流量分配': ['流量分配', '流量分陪'],
            '路由策略': ['路由策略', '路有策罗'],
            '服务发现': ['服务发现', '服務發現', '福物发线'],
            '健康检查': ['健康检查', '健康檢查', '见康简查'],
            '心跳检测': ['心跳检测', '心跳檢測', '心跳简测'],
            '状态监控': ['状态监控', '狀態監控', '状太见空'],
            '性能监控': ['性能监控', '性能監控', '兴能见空'],
            '日志收集': ['日志收集', '日誌收集', '日直收急'],
            '链路追踪': ['链路追踪', '鏈路追蹤', '连路追中'],
            '调用链': ['调用链', '調用鏈', '吊永连'],
            '依赖关系': ['依赖关系', '依賴關係', '一来官西'],
            '拓扑图': ['拓扑图', '拓撲圖', '拓破图'],
            '架构图': ['架构图', '架構圖', '家够图'],
            '流程图': ['流程图', '流程圖', '流成图'],
            '时序图': ['时序图', '時序圖', '识续图'],
            '类图': ['类图', '類圖', '累图'],
            '组件图': ['组件图', '組件圖', '族件图'],
            '部署图': ['部署图', '部署圖', '部书图'],
            '用例图': ['用例图', '用例圖', '永力图'],
            '活动图': ['活动图', '活動圖', '或动图'],
            '状态图': ['状态图', '狀態圖', '状太图'],
            '协作图': ['协作图', '協作圖', '些座图'],
            '包图': ['包图', '包圖', '报图'],
            '对象图': ['对象图', '對象圖', '对相图'],
            '复合结构图': ['复合结构图', '複合結構圖', '父和结够图'],
            '轮廓图': ['轮廓图', '輪廓圖', '论扩图'],
            '交互概览图': ['交互概览图', '交互概覽圖', '交护概揽图'],
            '时间图': ['时间图', '時間圖', '识见图'],

            # 地名
            '西雅图': ['西雅图', '西亞圖', '系绕图', '系雅图'],
            '纽约': ['纽约', '紐約', '纽月', '扭月', '翁纽约'],

            # 其他专有名词
            'GitHub': ['GitHub', 'github', 'GateHop', 'Git Hub'],
            'GitLab': ['GitLab', 'gitlab', 'Git Lab'],
            'Docker': ['Docker', 'docker', '多克'],
            'Kubernetes': ['Kubernetes', 'kubernetes', 'K8s', 'k8s'],
            'Python': ['Python', 'python', '拍赏', '派森'],
            'JavaScript': ['JavaScript', 'javascript', 'JS', 'js'],
            'TypeScript': ['TypeScript', 'typescript', 'TS', 'ts'],
            'React': ['React', 'react'],
            'Vue': ['Vue', 'vue'],
            'Angular': ['Angular', 'angular'],
            'Node.js': ['Node.js', 'nodejs', 'node.js', 'NodeJS'],
            'Flask': ['Flask', 'flask'],
            'Django': ['Django', 'django'],
            'Spring': ['Spring', 'spring'],
            'Redis': ['Redis', 'redis'],
            'MongoDB': ['MongoDB', 'mongodb', 'mongo'],
            'MySQL': ['MySQL', 'mysql'],
            'PostgreSQL': ['PostgreSQL', 'postgresql', 'postgres'],
            'Nginx': ['Nginx', 'nginx'],
            'Apache': ['Apache', 'apache'],
            'Linux': ['Linux', 'linux'],
            'Windows': ['Windows', 'windows'],
            'macOS': ['macOS', 'macos', 'MacOS'],
            'iOS': ['iOS', 'ios', 'IOS'],
            'Android': ['Android', 'android'],
            'AWS': ['AWS', 'aws'],
            'Azure': ['Azure', 'azure'],
            'GCP': ['GCP', 'gcp', 'Google Cloud Platform'],
            'GPU': ['GPU', 'gpu'],
            'CPU': ['CPU', 'cpu'],
            'RAM': ['RAM', 'ram'],
            'SSD': ['SSD', 'ssd'],
            'HDD': ['HDD', 'hdd'],
            'TCP': ['TCP', 'tcp'],
            'UDP': ['UDP', 'udp'],
            'DNS': ['DNS', 'dns'],
            'SSL': ['SSL', 'ssl'],
            'TLS': ['TLS', 'tls'],
            'OAuth': ['OAuth', 'oauth'],
            'JWT': ['JWT', 'jwt'],
            'REST': ['REST', 'rest', 'RESTful', 'restful'],
            'GraphQL': ['GraphQL', 'graphql'],
            'gRPC': ['gRPC', 'grpc'],
            'SQL': ['SQL', 'sql'],
            'NoSQL': ['NoSQL', 'nosql'],
            'ORM': ['ORM', 'orm'],
            'CLI': ['CLI', 'cli'],
            'GUI': ['GUI', 'gui'],
            'IDE': ['IDE', 'ide'],
            'CI/CD': ['CI/CD', 'cicd', 'CI CD'],
            'DevOps': ['DevOps', 'devops'],
            'MLOps': ['MLOps', 'mlops'],
            'AIOps': ['AIOps', 'aiops'],
            'SRE': ['SRE', 'sre'],
            'QA': ['QA', 'qa'],
            'UI': ['UI', 'ui'],
            'UX': ['UX', 'ux'],
            'ML': ['ML', 'ml'],
            'AI': ['AI', 'ai'],
            'NLP': ['NLP', 'nlp'],
            'CV': ['CV', 'cv'],
            'IoT': ['IoT', 'iot'],
            'VR': ['VR', 'vr'],
            'AR': ['AR', 'ar'],
            'XR': ['XR', 'xr'],
            'API Gateway': ['API Gateway', 'api gateway'],
            'Service Mesh': ['Service Mesh', 'service mesh'],
            'Load Balancer': ['Load Balancer', 'load balancer'],
            'Message Queue': ['Message Queue', 'message queue'],
            'Event Bus': ['Event Bus', 'event bus'],
            'Data Lake': ['Data Lake', 'data lake'],
            'Data Warehouse': ['Data Warehouse', 'data warehouse'],
            'ETL': ['ETL', 'etl'],
            'CDC': ['CDC', 'cdc'],
            'CQRS': ['CQRS', 'cqrs'],
            'DDD': ['DDD', 'ddd', 'Domain Driven Design'],
            'TDD': ['TDD', 'tdd', 'Test Driven Development'],
            'BDD': ['BDD', 'bdd', 'Behavior Driven Development'],
            'SOLID': ['SOLID', 'solid'],
            'DRY': ['DRY', 'dry'],
            'KISS': ['KISS', 'kiss'],
            'YAGNI': ['YAGNI', 'yagni'],
            'MVP': ['MVP', 'mvp'],
            'MVC': ['MVC', 'mvc'],
            'MVVM': ['MVVM', 'mvvm'],
            'PWA': ['PWA', 'pwa'],
            'SPA': ['SPA', 'spa'],
            'SSR': ['SSR', 'ssr'],
            'SSG': ['SSG', 'ssg'],
            'CDN': ['CDN', 'cdn'],
            'WAF': ['WAF', 'waf'],
            'VPN': ['VPN', 'vpn'],
            'CORS': ['CORS', 'cors'],
            'CSRF': ['CSRF', 'csrf'],
            'XSS': ['XSS', 'xss'],
            'SQL Injection': ['SQL Injection', 'sql injection'],
            'OWASP': ['OWASP', 'owasp'],
            'GDPR': ['GDPR', 'gdpr'],
            'PCI DSS': ['PCI DSS', 'pci dss'],
            'SOC': ['SOC', 'soc'],
            'ISO': ['ISO', 'iso'],
            'RFC': ['RFC', 'rfc'],
            'W3C': ['W3C', 'w3c'],
            'IETF': ['IETF', 'ietf'],
            'IEEE': ['IEEE', 'ieee'],
            'ACM': ['ACM', 'acm'],
        }

    def optimize_document(self, input_path: Path) -> str:
        """深度优化单个文档"""
        with open(input_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # 第一步：修正技术术语
        optimized = self._fix_terms(content)

        # 第二步：修正标点符号
        optimized = self._fix_punctuation(optimized)

        # 第三步：智能分段
        optimized = self._smart_paragraph(optimized)

        # 第四步：识别和创建章节结构
        optimized = self._create_sections(optimized, input_path.stem)

        # 第五步：添加代码块和格式化
        optimized = self._format_content(optimized)

        return optimized

    def _fix_terms(self, text: str) -> str:
        """修正技术术语"""
        for correct_term, variations in self.tech_terms.items():
            for variant in variations:
                if variant != correct_term and variant in text:
                    # 使用更智能的替换策略
                    text = text.replace(variant, correct_term)
        return text

    def _fix_punctuation(self, text: str) -> str:
        """修正标点符号"""
        # 修正中英文标点混用
        text = re.sub(r'([。！？，：；])\s*', r'\1\n', text)
        text = re.sub(r'\n+', '\n\n', text)
        return text

    def _smart_paragraph(self, text: str) -> str:
        """智能分段"""
        lines = text.split('\n')
        result = []
        current_paragraph = []

        for line in lines:
            line = line.strip()
            if not line:
                if current_paragraph:
                    result.append(' '.join(current_paragraph))
                    current_paragraph = []
            else:
                current_paragraph.append(line)
                # 检测段落结束信号
                if any(line.endswith(p) for p in ['。', '！', '？']):
                    if len(' '.join(current_paragraph)) > 200:
                        result.append(' '.join(current_paragraph))
                        current_paragraph = []

        if current_paragraph:
            result.append(' '.join(current_paragraph))

        return '\n\n'.join(result)

    def _create_sections(self, text: str, title: str) -> str:
        """创建章节结构"""
        sections = []
        paragraphs = text.split('\n\n')

        # 章节识别规则
        section_rules = {
            '概述': ['什么是', '简单来说', '首先', '介绍', '概念'],
            '背景': ['背景', '原因', '为什么', '问题'],
            '核心概念': ['核心', '关键', '重要', '主要', '基本'],
            '原理与机制': ['原理', '工作机制', '如何工作', '实现方式'],
            '架构设计': ['架构', '结构', '组成', '模块', '组件'],
            '使用场景': ['场景', '例子', '案例', '使用', '应用'],
            '实现步骤': ['实现', '步骤', '流程', '方法', '代码'],
            '对比分析': ['对比', '区别', '不同', '相比', '比较'],
            '最佳实践': ['最佳实践', '建议', '推荐', '技巧', '注意'],
            '问题与解决': ['问题', '解决', '处理', '错误', '异常'],
            '总结': ['总结', '总的来说', '最后', '结论', '回顾'],
        }

        current_section = '引言'
        current_content = []

        for para in paragraphs:
            section_found = False
            for section_name, keywords in section_rules.items():
                if any(kw in para[:100] for kw in keywords):
                    if current_content:
                        sections.append((current_section, current_content))
                    current_section = section_name
                    current_content = [para]
                    section_found = True
                    break

            if not section_found:
                current_content.append(para)

        if current_content:
            sections.append((current_section, current_content))

        # 生成Markdown
        md = f"# {title}\n\n"

        # 生成目录
        if len(sections) > 3:
            md += "## 目录\n\n"
            for section_name, _ in sections:
                md += f"- [{section_name}](#{section_name.lower().replace(' ', '-')})\n"
            md += "\n---\n\n"

        # 生成章节内容
        for section_name, content_list in sections:
            md += f"## {section_name}\n\n"
            for para in content_list:
                md += f"{para}\n\n"

        return md

    def _format_content(self, text: str) -> str:
        """格式化内容，添加代码块等"""
        # 识别命令行命令
        text = re.sub(
            r'((?:npm|pip|conda|python|node|git|docker|kubectl|uv)\s+[^\n]+)',
            r'```bash\n\1\n```',
            text
        )

        # 识别路径
        text = re.sub(
            r'(?<![`])((?:/[a-zA-Z0-9_\-]+)+(?:/[a-zA-Z0-9_\-\.]+)?)',
            r'`\1`',
            text
        )

        # 识别URL
        text = re.sub(
            r'(?<!\[)(https?://[^\s\)]+)',
            r'[\1](\1)',
            text
        )

        # 添加列表格式
        text = re.sub(
            r'^(\d+)\.\s*',
            r'\1. ',
            text,
            flags=re.MULTILINE
        )

        # 添加强调
        important_terms = ['注意', '重要', '关键', '核心', '必须', '警告', '提示']
        for term in important_terms:
            text = re.sub(
                f'({term}[：:].+?)([。！？])',
                r'**\1**\2',
                text
            )

        return text

def main():
    input_dir = Path("storage/results/mark_transcripts/markdown")
    output_dir = Path("storage/results/mark_transcripts/optimized")
    output_dir.mkdir(exist_ok=True)

    optimizer = DeepDocumentOptimizer()

    md_files = list(input_dir.glob("*.md"))
    print(f"📚 找到 {len(md_files)} 个文档待优化\n")

    for md_file in md_files:
        print(f"🔄 正在优化: {md_file.name}")
        try:
            optimized_content = optimizer.optimize_document(md_file)
            output_file = output_dir / md_file.name
            with open(output_file, 'w', encoding='utf-8') as f:
                f.write(optimized_content)
            print(f"✅ 完成: {output_file.name}\n")
        except Exception as e:
            print(f"❌ 失败: {e}\n")

if __name__ == "__main__":
    main()